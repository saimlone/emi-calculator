<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>EMI Calculator</title>

    <!-- Bootstrap CSS CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet" />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap"
      rel="stylesheet" />

    <style>
      :root {
        --bg: #0f1724;
        --card: #0b1220;
        --accent: #6ee7b7;
        --muted: #94a3b8;
        --glass: rgba(255, 255, 255, 0.03);
      }
      body {
        font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto,
          "Helvetica Neue", Arial;
        background: linear-gradient(180deg, #071028 0%, #08122a 60%);
        color: #e6eef8;
        min-height: 100vh;
        padding: 2rem 1rem;
      }
      .card {
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.02),
          rgba(255, 255, 255, 0.01)
        );
        border: 1px solid rgba(255, 255, 255, 0.04);
        box-shadow: 0 6px 20px rgba(2, 6, 23, 0.6);
      }
      h1 small {
        color: var(--muted);
        display: block;
        font-weight: 400;
      }
      .form-label {
        color: var(--muted);
      }
      .result-box {
        background: linear-gradient(
          90deg,
          rgba(110, 231, 183, 0.06),
          rgba(180, 218, 12, 0.02)
        );
        border-left: 3px solid rgba(110, 231, 183, 0.18);
        padding: 1rem;
        border-radius: 8px;
        color: bisque;
      }
      .muted {
        color: var(--muted);
      }
      .table-wrap {
        max-height: 260px;
        overflow: auto;
      }
      .small-muted {
        font-size: 0.85rem;
        color: var(--muted);
      }
      footer {
        text-align: center;
        color: var(--muted);
        margin-top: 1.5rem;
        font-size: 0.9rem;
      }
      .btn-accent {
        background: linear-gradient(90deg, #10b981, #06b6d4);
        border: none;
        color: #04202b;
        font-weight: 600;
      }
      .mb-0 {
        color: white;
      }
      .mb-1 {
        color: white;
      }
      #downloadCsv {
        background: linear-gradient(90deg, #009619);
        border: none;
        color: #04202b;
        font-weight: 400;
        border-radius: 5px;
        color: rgb(249, 253, 253);
        padding: 5px;
      }
      #downloadCsv:active {
        background-color: #0b1220;
        transform: scale(1.07);
      }

      /* responsive tweaks */
      @media (min-width: 992px) {
        .hero-grid {
          display: grid;
          grid-template-columns: 1fr 420px;
          gap: 1.5rem;
          align-items: start;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="hero-grid mb-4">
        <div>
          <div class="mb-3">
            <h1 class="mb-0">
              EMI Calculator <small>Simple • Interactive</small>
            </h1>
            <p class="small-muted">
              Enter loan details to calculate monthly EMI, total interest and
              payment.
            </p>
          </div>

          <div class="card p-3">
            <form id="emiForm" class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Loan Amount (Principal)</label>
                <div class="input-group">
                  <span class="input-group-text">₹</span>
                  <input
                    id="principal"
                    type="number"
                    min="0"
                    step="100"
                    class="form-control"
                    placeholder="e.g. 500000"
                    required />
                </div>
                <div class="form-text small-muted">
                  Use numbers only. Round values for clarity.
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label">Annual Interest Rate (%)</label>
                <div class="input-group">
                  <input
                    id="annualRate"
                    type="number"
                    min="0"
                    step="0.01"
                    class="form-control"
                    placeholder="e.g. 8.45"
                    required />
                  <span class="input-group-text">%</span>
                </div>
              </div>

              <div class="col-md-6">
                <label class="form-label">Tenure</label>
                <div class="row g-2">
                  <div class="col-6">
                    <input
                      id="tenureYears"
                      type="number"
                      min="0"
                      step="1"
                      class="form-control"
                      placeholder="Years"
                      value="" />
                  </div>
                  <div class="col-6">
                    <input
                      id="tenureMonths"
                      type="number"
                      min="0"
                      max="11"
                      step="1"
                      class="form-control"
                      placeholder="Months"
                      value="" />
                  </div>
                </div>
                <div class="form-text small-muted">
                  You can use years + months (e.g., 2 years 6 months).
                </div>
              </div>

              <div class="col-md-6 d-flex align-items-end gap-2">
                <button id="calcBtn" class="btn btn-accent w-100">
                  Calculate EMI
                </button>
                <button
                  id="resetBtn"
                  type="button"
                  class="btn btn-outline-light w-100">
                  Reset
                </button>
              </div>
            </form>

            <hr class="my-3" />

            <div id="resultsArea" class="d-none">
              <div class="row g-3">
                <div class="col-md-4">
                  <div class="result-box">
                    <div class="muted">Monthly EMI</div>
                    <div class="h4 mb-0" id="emiResult">—</div>
                    <div class="small-muted mt-1">Click copy to copy EMI</div>
                    <div class="mt-2">
                      <button id="copyEmi" class="btn btn-sm btn-light">
                        Copy EMI
                      </button>
                    </div>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="result-box">
                    <div class="muted">Total Payment</div>
                    <div class="h5 mb-0" id="totalPayment">—</div>
                    <div class="small-muted mt-1">Principal + Interest</div>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="result-box">
                    <div class="muted">Total Interest</div>
                    <div class="h5 mb-0" id="totalInterest">—</div>
                    <div class="small-muted mt-1">
                      Amount paid over principal
                    </div>
                  </div>
                </div>
              </div>

              <div class="mt-3">
                <div
                  class="d-flex justify-content-between align-items-center mb-2">
                  <h6 class="mb-0">Amortization Schedule</h6>
                  <div>
                    <button
                      id="toggleTable"
                      class="btn btn-sm btn-outline-light">
                      Show/Hide
                    </button>
                    <button id="downloadCsv" class="btn btn-sm btn-light">
                      Download CSV
                    </button>
                  </div>
                </div>

                <div id="tableWrap" class="table-wrap d-none">
                  <table
                    class="table table-sm table-striped text-white align-middle">
                    <thead class="small-muted">
                      <tr>
                        <th>#</th>
                        <th>Payment</th>
                        <th>Principal</th>
                        <th>Interest</th>
                        <th>Balance</th>
                      </tr>
                    </thead>
                    <tbody id="amortTableBody"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

        <aside>
          <div class="card p-3">
            <h5 class="mb-1">Tips & Notes</h5>
            <p class="small-muted mb-1">
              • EMI is calculated monthly. Make sure to use the annual rate (%)
              not monthly.
            </p>
            <p class="small-muted mb-1">
              • Use the amortization table to show month-by-month breakdown.
            </p>
            <p class="small-muted mb-0">
              • Export CSV to show clients or include in reports.
            </p>
          </div>

          <div class="card p-3 mt-3">
            <h6 class="mb-1">About</h6>
            <h7 class="small-muted mb-0">
              We built this EMI Calculator to help you take control of your
              finances. Whether you're planning a car loan, home loan, or
              personal loan, our tool gives you instant, accurate results so you
              can make informed choices.
            </h7>
          </div>
        </aside>
      </div>

      <footer>©Built by Saim Lone</footer>
    </div>

    <!-- Bootstrap JS (for components) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      // Helper: format numbers as Indian currency/locale
      function formatAmount(x) {
        if (isNaN(x) || x === Infinity) return "—";
        // Use Intl.NumberFormat. For Indian grouping, use 'en-IN'.
        return new Intl.NumberFormat("en-IN", {
          style: "currency",
          currency: "INR",
          maximumFractionDigits: 2,
        }).format(x);
      }

      // Compute EMI
      function computeEMI(P, annualRate, nMonths) {
        if (nMonths <= 0)
          return { emi: 0, totalPayment: 0, totalInterest: 0, schedule: [] };
        const r = annualRate / 12 / 100; // monthly rate
        // If interest is zero, simple division
        let emi;
        if (r === 0) {
          emi = P / nMonths;
        } else {
          const onePlusRpowN = Math.pow(1 + r, nMonths);
          emi = (P * r * onePlusRpowN) / (onePlusRpowN - 1);
        }

        const totalPayment = emi * nMonths;
        const totalInterest = totalPayment - P;

        // Build amortization schedule month by month
        let balance = P;
        const schedule = [];
        for (let m = 1; m <= nMonths; m++) {
          const interest = balance * r;
          const principal = Math.min(balance, emi - interest);
          balance = Math.max(0, balance - principal);
          schedule.push({
            month: m,
            payment: emi,
            principal: principal,
            interest: interest,
            balance: balance,
          });
        }

        return { emi, totalPayment, totalInterest, schedule };
      }

      // DOM elements
      const emiForm = document.getElementById("emiForm");
      const principalIn = document.getElementById("principal");
      const annualRateIn = document.getElementById("annualRate");
      const tenureYears = document.getElementById("tenureYears");
      const tenureMonths = document.getElementById("tenureMonths");

      const resultsArea = document.getElementById("resultsArea");
      const emiResult = document.getElementById("emiResult");
      const totalPayment = document.getElementById("totalPayment");
      const totalInterest = document.getElementById("totalInterest");
      const amortTableBody = document.getElementById("amortTableBody");
      const tableWrap = document.getElementById("tableWrap");
      const toggleTable = document.getElementById("toggleTable");
      const downloadCsv = document.getElementById("downloadCsv");
      const copyEmi = document.getElementById("copyEmi");
      const calcBtn = document.getElementById("calcBtn");
      const resetBtn = document.getElementById("resetBtn");

      // Run calculation
      emiForm.addEventListener("submit", function (e) {
        e.preventDefault();
        // Read & validate inputs
        const P = parseFloat(principalIn.value);
        const annual = parseFloat(annualRateIn.value);
        const yrs = parseInt(tenureYears.value || 0, 10);
        const months = parseInt(tenureMonths.value || 0, 10);

        if (isNaN(P) || P <= 0) {
          alert("Enter a valid loan amount (principal).");
          principalIn.focus();
          return;
        }
        if (isNaN(annual) || annual < 0) {
          alert("Enter a valid annual interest rate (0 or positive).");
          annualRateIn.focus();
          return;
        }
        if (isNaN(yrs) || isNaN(months) || (yrs === 0 && months === 0)) {
          alert("Enter a valid tenure (years or months).");
          tenureYears.focus();
          return;
        }

        const totalMonths = yrs * 12 + months;
        const result = computeEMI(P, annual, totalMonths);

        // Update UI
        emiResult.textContent = formatAmount(result.emi);
        totalPayment.textContent = formatAmount(result.totalPayment);
        totalInterest.textContent = formatAmount(result.totalInterest);

        // Build amortization table rows
        amortTableBody.innerHTML = "";
        result.schedule.forEach((row) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
        <td>${row.month}</td>
        <td>${formatAmount(row.payment)}</td>
        <td>${formatAmount(row.principal)}</td>
        <td>${formatAmount(row.interest)}</td>
        <td>${formatAmount(row.balance)}</td>
      `;
          amortTableBody.appendChild(tr);
        });

        resultsArea.classList.remove("d-none");
        tableWrap.classList.add("d-none"); // hide table by default
        tableWrap.classList.remove("d-block");
      });

      // Toggle amortization table
      toggleTable.addEventListener("click", () => {
        if (tableWrap.classList.contains("d-none")) {
          tableWrap.classList.remove("d-none");
          tableWrap.classList.add("d-block");
        } else {
          tableWrap.classList.add("d-none");
        }
      });

      // Download CSV
      downloadCsv.addEventListener("click", () => {
        const rows = [];
        // Header
        rows.push(["Month", "Payment", "Principal", "Interest", "Balance"]);
        // Read rows from table body
        document.querySelectorAll("#amortTableBody tr").forEach((tr) => {
          const cols = Array.from(tr.querySelectorAll("td")).map((td) =>
            td.textContent.replace(/₹|,/g, "").trim()
          );
          rows.push(cols);
        });

        if (rows.length <= 1) {
          alert("No amortization data to download. Calculate first.");
          return;
        }

        const csvContent = rows.map((r) => r.join(",")).join("\\n");
        const blob = new Blob([csvContent], {
          type: "text/csv;charset=utf-8;",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "amortization_schedule.csv";
        a.click();
        URL.revokeObjectURL(url);
      });

      // Copy EMI
      copyEmi.addEventListener("click", () => {
        const text = emiResult.textContent;
        if (!text || text === "—") {
          alert("Calculate EMI first.");
          return;
        }
        navigator.clipboard
          .writeText(text)
          .then(() => {
            copyEmi.textContent = "Copied ✓";
            setTimeout(() => (copyEmi.textContent = "Copy EMI"), 1500);
          })
          .catch(() => {
            alert("Unable to copy.");
          });
      });

      // Reset form
      resetBtn.addEventListener("click", () => {
        emiForm.reset();
        tenureMonths.value = 12;
        resultsArea.classList.add("d-none");
        amortTableBody.innerHTML = "";
        tableWrap.classList.add("d-none");
      });

      // small nicety: Enter on numeric fields triggers calculate
      [principalIn, annualRateIn, tenureYears, tenureMonths].forEach((i) => {
        i.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            calcBtn.click();
          }
        });
      });
    </script>
  </body>
</html>
